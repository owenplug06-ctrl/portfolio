---
title: "hw8"
format: 
  html:
    output-file: "index"
embed-resources: true
---

Exercise 1:

```{r}
#| echo: false
library(vegawidget)

spec1 <- '{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Supply (Capacity) and Demand Over Time",
  "data": {
    "url": "https://calvin-data304.netlify.app/data/swd-lets-practice-ex-2-3.json"
  },
  "transform": [
    {"fold": ["capacity", "demand"], "as": ["metric", "value"]},
    {"calculate": "datetime(datum.date + \'-01\')", "as": "date_clean"}
  ],
  "mark": {"type": "line", "point": true, "strokeWidth": 2.5},
  "encoding": {
    "x": {
      "field": "date_clean", "type": "temporal", "title": "Month",
      "axis": {"format": "%b %Y", "labelAngle": -45, "labelAlign": "right"}
    },
    "y": {"field": "value", "type": "quantitative", "title": "Megawatts (MW)"},
    "color": {
      "field": "metric", "type": "nominal", "title": "Metric",
      "scale": {"domain": ["capacity", "demand"], "range": ["#4c78a8", "#f58518"]}
    }
  },
  "width": 700, "height": 400,
  "title": "Supply (Capacity) and Demand Over Time"
}'

# Graphic 3: Supply and Demand Bar Chart
spec3 <- '{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Supply and Demand Comparison (Bar Chart)",
  "data": {
    "url": "https://calvin-data304.netlify.app/data/swd-lets-practice-ex-2-3.json"
  },
  "transform": [
    {"fold": ["capacity", "demand"], "as": ["metric", "value"]},
    {"calculate": "datetime(datum.date + \'-01\')", "as": "date_clean"}
  ],
  "mark": {"type": "bar", "width": 15},
  "encoding": {
    "x": {
      "field": "date_clean", "type": "temporal", "title": "Month",
      "axis": {"format": "%b %Y", "labelAngle": -45, "labelAlign": "right"}
    },
    "y": {"field": "value", "type": "quantitative", "title": "Megawatts (MW)"},
    "color": {
      "field": "metric", "type": "nominal", "title": "Metric",
      "scale": {"domain": ["capacity", "demand"], "range": ["#4c78a8", "#f58518"]}
    },
    "xOffset": {"field": "metric"}
  },
  "width": 700, "height": 400,
  "title": "Supply and Demand Comparison"
}'

spec1 |> as_vegaspec()  # Basic lines
spec3 |> as_vegaspec()  # Bar chart
```
```{r}
#| echo: false
library(vegawidget)

# Side-by-side bar chart comparing Demand and Capacity - CORRECTED
spec_side_by_side <- '{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Demand vs Capacity Side-by-Side Bar Chart",
  "data": {
    "url": "https://calvin-data304.netlify.app/data/swd-lets-practice-ex-2-3.json"
  },
  "transform": [
    {"fold": ["demand", "capacity"], "as": ["metric", "value"]},
    {"calculate": "datetime(datum.date + \'-01\')", "as": "date_clean"},
    {"calculate": "year(datum.date_clean)", "as": "year"},
    {"calculate": "month(datum.date_clean)", "as": "month"}
  ],
  "mark": {"type": "bar", "width": {"band": 0.8}},
  "encoding": {
    "x": {
      "field": "date_clean",
      "type": "ordinal",
      "title": "Month",
      "axis": {"labelAngle": -45, "labelAlign": "right", "format": "%b %Y"},
      "timeUnit": "yearmonth",
      "sort": {"field": "date_clean", "order": "ascending"}
    },
    "xOffset": {
      "field": "metric",
      "type": "nominal"
    },
    "y": {
      "field": "value",
      "type": "quantitative",
      "title": "Megawatts (MW)",
      "axis": {"grid": true}
    },
    "color": {
      "field": "metric",
      "type": "nominal",
      "title": "Metric",
      "scale": {
        "domain": ["demand", "capacity"],
        "range": ["#f58518", "#4c78a8"]
      },
      "legend": {"title": null, "orient": "top"}
    },
    "tooltip": [
      {"field": "date", "type": "nominal", "title": "Month"},
      {"field": "metric", "type": "nominal", "title": "Type"},
      {"field": "value", "type": "quantitative", "title": "Value", "format": ",.0f"}
    ]
  },
  "width": 700,
  "height": 400,
  "title": {
    "text": "Demand vs Capacity: Side-by-Side Comparison",
    "fontSize": 14,
    "fontWeight": "bold",
    "anchor": "start",
    "offset": 10
  }
}'

# Display the chart
spec_side_by_side |> as_vegaspec()
```
```{r}
#| echo: false
library(vegawidget)

# Unmet Demand Line Graph
spec_unmet_demand <- '{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Unmet Demand Over Time",
  "data": {
    "url": "https://calvin-data304.netlify.app/data/swd-lets-practice-ex-2-3.json"
  },
  "transform": [
    {"calculate": "datetime(datum.date + \'-01\')", "as": "date_clean"},
    {"calculate": "datum.demand - datum.capacity", "as": "unmet_demand"}
  ],
  "mark": {
    "type": "line",
    "point": {
      "filled": true,
      "size": 80,
      "color": "#e45756",
      "stroke": "white",
      "strokeWidth": 1.5
    },
    "strokeWidth": 3,
    "color": "#e45756"
  },
  "encoding": {
    "x": {
      "field": "date_clean",
      "type": "temporal",
      "title": "Month",
      "axis": {
        "format": "%b %Y",
        "labelAngle": -45,
        "labelAlign": "right",
        "grid": false
      }
    },
    "y": {
      "field": "unmet_demand",
      "type": "quantitative",
      "title": "Unmet Demand (MW)",
      "axis": {
        "grid": true,
        "gridColor": "#e9e9e9"
      }
    },
    "tooltip": [
      {
        "field": "date",
        "type": "nominal",
        "title": "Month"
      },
      {
        "field": "demand",
        "type": "quantitative",
        "title": "Demand",
        "format": ",.0f"
      },
      {
        "field": "capacity",
        "type": "quantitative",
        "title": "Capacity",
        "format": ",.0f"
      },
      {
        "field": "unmet_demand",
        "type": "quantitative",
        "title": "Unmet Demand",
        "format": ",.0f"
      }
    ]
  },
  "width": 700,
  "height": 400,
  "title": {
    "text": "Unmet Demand Over Time (Demand - Capacity)",
    "fontSize": 14,
    "fontWeight": "bold",
    "anchor": "start",
    "offset": 10
  }
}'

# Display the chart
spec_unmet_demand |> as_vegaspec()
```
```{r}
#| echo: false
library(vegawidget)

# Demand as thinner bar above capacity bar
spec_demand_thinner_bar <- '{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Capacity bars with thinner demand bars above",
  "data": {
    "url": "https://calvin-data304.netlify.app/data/swd-lets-practice-ex-2-3.json"
  },
  "transform": [
    {"calculate": "datetime(datum.date + \'-01\')", "as": "date_clean"},
    {"calculate": "datum.demand - datum.capacity", "as": "unmet_demand"},
    {"calculate": "datum.capacity", "as": "capacity_fill"},
    {"calculate": "if(datum.unmet_demand > 0, datum.unmet_demand, 0)", "as": "excess_demand"}
  ],
  "layer": [
{
      "mark": {"type": "bar", "width": {"band": 0.3}, "color": "#f58518"},
      "encoding": {
        "x": {
          "field": "date_clean",
          "type": "temporal",
          "timeUnit": "yearmonth"
        },
        "y": {
          "field": "demand",
          "type": "quantitative"
        }
      }
    },
    {
      "mark": {"type": "bar", "width": {"band": 0.7}, "color": "#4c78a8"},
      "encoding": {
        "x": {
          "field": "date_clean",
          "type": "temporal",
          "timeUnit": "yearmonth",
          "title": "Month",
          "axis": {"format": "%b %Y", "labelAngle": -45, "labelAlign": "right"}
        },
        "y": {
          "field": "capacity_fill",
          "type": "quantitative",
          "title": "Megawatts (MW)"
        }
      }
    }
  ],
  "width": 700,
  "height": 400,
  "title": {
    "text": "Capacity Bars (Wide) with Thinner Demand Bars Above",
    "fontSize": 14,
    "fontWeight": "bold",
    "anchor": "start",
    "offset": 10
  }
}'

# Display the chart
spec_demand_thinner_bar |> as_vegaspec()
```
```{r}
#| echo: false
library(vegawidget)

# Only red connecting lines between demand and capacity points
spec_only_connecting_lines <- '{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Only connecting lines between demand and capacity points",
  "data": {
    "url": "https://calvin-data304.netlify.app/data/swd-lets-practice-ex-2-3.json"
  },
  "transform": [
    {"calculate": "datetime(datum.date + \'-01\')", "as": "date_clean"},
    {"calculate": "datum.demand - datum.capacity", "as": "unmet_demand"}
  ],
  "layer": [
    {
      "mark": {"type": "point", "color": "#4c78a8", "size": 100, "filled": true},
      "encoding": {
        "x": {
          "field": "date_clean",
          "type": "temporal",
          "timeUnit": "yearmonth",
          "title": "Month",
          "axis": {"format": "%b %Y", "labelAngle": -45, "labelAlign": "right"}
        },
        "y": {
          "field": "capacity",
          "type": "quantitative",
          "title": "Megawatts (MW)"
        }
      }
    },
    {
      "mark": {"type": "point", "color": "#f58518", "size": 100, "filled": true},
      "encoding": {
        "x": {
          "field": "date_clean",
          "type": "temporal",
          "timeUnit": "yearmonth"
        },
        "y": {
          "field": "demand",
          "type": "quantitative"
        }
      }
    },
    {
      "transform": [
        {"filter": "datum.demand != datum.capacity"}
      ],
      "mark": {
        "type": "rule",
        "color": "#e45756",
        "strokeWidth": 2,
        "opacity": 0.8
      },
      "encoding": {
        "x": {
          "field": "date_clean",
          "type": "temporal",
          "timeUnit": "yearmonth"
        },
        "y": {"field": "capacity", "type": "quantitative"},
        "y2": {"field": "demand", "type": "quantitative"},
        "tooltip": [
          {"field": "date", "type": "nominal", "title": "Month"},
          {"field": "capacity", "type": "quantitative", "title": "Capacity", "format": ",.0f"},
          {"field": "demand", "type": "quantitative", "title": "Demand", "format": ",.0f"},
          {"field": "unmet_demand", "type": "quantitative", "title": "Gap", "format": ",.0f"}
        ]
      }
    }
  ],
  "width": 700,
  "height": 400,
  "title": {
    "text": "Demand (Orange) and Capacity (Blue) Points with Red Connecting Lines",
    "fontSize": 14,
    "fontWeight": "bold",
    "anchor": "start",
    "offset": 10
  }
}'

# Display the chart
spec_only_connecting_lines |> as_vegaspec()
```

